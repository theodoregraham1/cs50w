{% extends "auctions/layout.html" %}

{% block body %}
    <div class="mx-3">
        <!-- Title -->
        <div class="row mt-3">
            <h1 class=""><b>Listing:</b> {{listing.title}}</h1>
        </div>
        
        <!-- Watchlist button -->
        <div class="row">
            {% if user.is_authenticated %}
                {% if watchlisted %}
                    <a href="{% url 'add_to_watchlist' listing.id %}" class="btn btn-secondary">Remove from watchlist</a>
                {% else %}
                    <a href="{% url 'add_to_watchlist' listing.id %}" class="btn btn-primary">Add to watchlist</a>
                {% endif %}
            {% endif %}
        </div>

        <!-- Image -->
        <div class="row mt-3">
            {% if listing.image_url %}
                <img class="listing-img" src="{{listing.image_url}}" alt="Image for listing: {{listing.title}}">
            {% else %}
                <h4 class="">No image found</h2>
            {% endif %}
        </div>

        <!-- Description -->
        <div class="row mt-1">
            <p class="fs-3">{{listing.description}}</p>
        </div>

        <!-- Price -->
        <div class="row">
            <h2>{{price}}</h2>
        </div>
        <div class="row">
            <div class="fs-6">
                {{num_bids}} bid(s). 
                {% if user == listing.user %} This is your listing.
                {% elif top_bid %}{% if top_bid.user.id == user.id %}Your bid is the current bid.{% endif %}{% endif %}
            </div>
        </div>

        {% if user.is_authenticated and user != listing.user%}
            <!-- Place bid -->
            <div class="row">
                <form action="{% url 'add_bid' %}" method="post" class="col-md-12 mt-1">
                    {% csrf_token %}

                    <div class="row">
                        <div class="col-md-3">
                            {{ form.value }}
                        </div>
                        <div class="col-md-3">
                            <input type="submit" class="form-input btn btn-primary" value="Place Bid">
                        </div>
                    </div>

                    <input type="hidden" name="user" id="id_user" value="{{ user.id }}">
                    <input type="hidden" name="listing" id="id_listing" value="{{ listing.id }}">

                </form>
            </div>
        {% endif %}

        <!-- Details -->
        <div class="row mt-3">
            <p><b>Details: </b></p>
            <ul>
                <li><b>Category: </b>{{listing.category}}</li>
                <li><b>Seller: </b>{{listing.user}}</li>
            </ul>
        </div>
    </div>
{% endblock %}1